!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("tslib"),require("@angular/platform-server"),require("@angular/http"),require("rxjs/Observable"),require("rxjs/add/observable/fromPromise"),require("rxjs/add/operator/do"),require("rxjs/add/operator/map")):"function"==typeof define&&define.amd?define(["exports","@angular/core","tslib","@angular/platform-server","@angular/http","rxjs/Observable","rxjs/add/observable/fromPromise","rxjs/add/operator/do","rxjs/add/operator/map"],e):e((t.ngxUniversal=t.ngxUniversal||{},t.ngxUniversal.stateTransfer=t.ngxUniversal.stateTransfer||{}),t.ng.core,t.tslib,t.ng.platformServer,t.ng.http,t.Rx.Observable)}(this,function(t,e,r,n,o,a){"use strict";function i(t){return t.replace(/[&\<\>\\']/g,function(t){return c[t]})}function s(t){return t.replace(/(&amp;)|(&lt;)|(&gt;)|(&#39;)/g,function(t){return f[t]})}function u(t){var e=new p,r=window[t]||"",n=JSON.parse(s(r));return e.initialize(n),e}var p=function(){function t(){this.state=new Map}return t.prototype.initialize=function(t){var e=this;Object.keys(t).forEach(function(r){e.set(r,t[r])})},t.prototype.get=function(t){return this.state.get(t)},t.prototype.set=function(t,e){return this.state.set(t,e)},t.prototype.inject=function(){},t.prototype.toJson=function(){var t=this,e={};return Array.from(this.state.keys()).forEach(function(r){e[r]=t.get(r)}),e},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[]},t}(),c={"&":"&amp;","<":"&lt;",">":"&gt;","\\":"\\\\","'":"&#39;"},f={"&lt;":"<","&gt;":">","&amp;":"&","&#39;":"'"},d=new e.InjectionToken("STATE_ID"),l=function(t){function o(e,r,n){var o=t.call(this)||this;return o.stateId=e,o.platformState=r,o.rendererFactory=n,o}return r.__extends(o,t),o.prototype.inject=function(){try{var t=this.platformState.getDocument(),r=i(JSON.stringify(this.toJson())),n=this.rendererFactory.createRenderer(t,{id:"-1",encapsulation:e.ViewEncapsulation.None,styles:[],data:{}}),o=t.body;if(!o)throw new Error("<body> not found in the document");var a=n.createElement("script");n.setValue(a,"window['"+this.stateId+"'] = '"+r+"'"),n.appendChild(o,a)}catch(t){console.error(t)}},o.decorators=[{type:e.Injectable}],o.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[d]}]},{type:n.PlatformState},{type:e.RendererFactory2}]},o}(p),h=function(){function t(t,e){this.http=t,this.stateTransfer=e}return t.prototype.request=function(t,e){var r=this;return this.getData(t,e,function(t,e){return r.http.request(t,e)})},t.prototype.get=function(t,e){var r=this;return this.getData(t,e,function(t,e){return r.http.get(t,e)})},t.prototype.post=function(t,e,r){var n=this;return this.getPostData(t,e,r,function(t){return n.http.post(t,e,r)})},t.prototype.put=function(t,e,r){var n=this;return this.getData(t,r,function(t,e){return n.http.put(t,e)})},t.prototype.delete=function(t,e){var r=this;return this.getData(t,e,function(t,e){return r.http.delete(t,e)})},t.prototype.patch=function(t,e,r){var n=this;return this.getPostData(t,e,r,function(t){return n.http.patch(t,e,r)})},t.prototype.head=function(t,e){var r=this;return this.getData(t,e,function(t,e){return r.http.head(t,e)})},t.prototype.options=function(t,e){var r=this;return this.getData(t,e,function(t,e){return r.http.options(t,e)})},t.prototype.getData=function(t,e,r){var n=this,o=t;"string"!=typeof t&&(o=t.url);var a=o+JSON.stringify(e);try{return this.resolveData(a)}catch(o){return r(t,e).map(function(t){return t.json()}).do(function(t){n.setCache(a,t)})}},t.prototype.getPostData=function(t,e,r,n){var o=this,a=t;"string"!=typeof t&&(a=t.url);var i=a+JSON.stringify(e)+JSON.stringify(r);try{return this.resolveData(i)}catch(a){return n(t,e,r).map(function(t){return t.json()}).do(function(t){o.setCache(i,t)})}},t.prototype.resolveData=function(t){var e=this.getFromCache(t);if(!e)throw new Error;return a.Observable.fromPromise(Promise.resolve(e))},t.prototype.setCache=function(t,e){return this.stateTransfer.set(t,e)},t.prototype.getFromCache=function(t){return this.stateTransfer.get(t)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:o.Http},{type:p}]},t}(),y=function(){function t(t){if(t)throw new Error("HttpTransferModule already loaded; import in root module only.")}return t.forRoot=function(){return{ngModule:t}},t.decorators=[{type:e.NgModule,args:[{providers:[h]}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:e.Optional},{type:e.SkipSelf}]}]},t}(),v=function(){function t(t){if(t)throw new Error("BrowserStateTransferModule already loaded; import in BROWSER module only.")}return t.forRoot=function(e){return void 0===e&&(e="STATE"),{ngModule:t,providers:[{provide:p,useFactory:u,deps:[d]},{provide:d,useValue:e}]}},t.decorators=[{type:e.NgModule}],t.ctorParameters=function(){return[{type:t,decorators:[{type:e.Optional},{type:e.SkipSelf}]}]},t}(),g=function(){function t(t){if(t)throw new Error("ServerStateTransferModule already loaded; import in SERVER module only.")}return t.forRoot=function(e){return void 0===e&&(e="STATE"),{ngModule:t,providers:[{provide:d,useValue:e}]}},t.decorators=[{type:e.NgModule,args:[{providers:[{provide:p,useClass:l}]}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:e.Optional},{type:e.SkipSelf}]}]},t}();t.stateTransferFactory=u,t.HttpTransferModule=y,t.BrowserStateTransferModule=v,t.ServerStateTransferModule=g,t.STATE_ID=d,t.DEFAULT_STATE_ID="STATE",t.ServerStateTransferService=l,t.StateTransferService=p,t.HttpTransferService=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=state-transfer.umd.min.js.map
